"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[398],{576:(e,t,r)=>{r.d(t,{A:()=>n});let n=(0,r(4294).A)("Bell",[["path",{d:"M10.268 21a2 2 0 0 0 3.464 0",key:"vwvbt9"}],["path",{d:"M3.262 15.326A1 1 0 0 0 4 17h16a1 1 0 0 0 .74-1.673C19.41 13.956 18 12.499 18 8A6 6 0 0 0 6 8c0 4.499-1.411 5.956-2.738 7.326",key:"11g9vi"}]])},1398:(e,t,r)=>{r.d(t,{M:()=>m,default:()=>p});var n=r(5155),a=r(2115),s=r(2619),i=r.n(s),o=r(576),c=r(5897),l=r(7468),u=r(3998),d=r(4269);r(7868),r(4697);var f=r(4368);let h=(0,a.createContext)({notificationCount:0,refreshNotificationCount:()=>{}});function m(){return(0,a.useContext)(h)}function p(){var e;let[t,r]=(0,a.useState)(!1),[s,h]=(0,a.useState)(!1),{notificationCount:p,refreshNotificationCount:g}=m(),[x,v]=(0,a.useState)(null),w=l.oD.find(e=>"user-avatar"===e.id);(0,a.useEffect)(()=>{r(!0);let e=(0,d.wR)();h(e),e&&y()},[]),(0,a.useEffect)(()=>{let e=()=>{(0,d.wR)()&&y()},t=()=>{let e=(0,d.wR)();h(e),e?y():v(null)};return window.addEventListener("storage",t),window.addEventListener("profileUpdated",e),()=>{window.removeEventListener("storage",t),window.removeEventListener("profileUpdated",e)}},[]);let y=async()=>{try{let e=await (0,f.HW)();v(e)}catch(e){console.error("Error fetching user data:",e)}};return t?(0,n.jsx)("header",{className:"py-4 px-6 bg-background border-b shadow-sm sticky top-0 z-10",children:(0,n.jsxs)("div",{className:"container mx-auto flex justify-between items-center",children:[(0,n.jsx)(i(),{href:s?"/dashboard":"/",className:"flex items-center gap-2",children:(0,n.jsx)("h1",{className:"text-xl font-bold text-foreground font-headline",children:"HU Connect"})}),(0,n.jsx)("div",{className:"flex items-center gap-4",children:s?(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)("div",{className:"flex items-center gap-2",children:(0,n.jsxs)(i(),{href:"/notifications",className:"relative",children:[(0,n.jsx)(o.A,{className:"h-6 w-6 text-foreground"}),p>0&&(0,n.jsx)("span",{className:"absolute -top-2 -right-2 bg-red-500 text-white text-xs rounded-full h-5 w-5 flex items-center justify-center",children:p>99?"99+":p})]})}),(0,n.jsx)(i(),{href:"/profile",children:(0,n.jsx)(c.Avatar,{className:"h-8 w-8",children:(null==x?void 0:x.profilePicture)?(0,n.jsx)(c.AvatarImage,{src:x.profilePicture,alt:x.username}):w?(0,n.jsx)(c.AvatarImage,{src:w.imageUrl,alt:"User avatar"}):(0,n.jsx)(c.AvatarFallback,{children:(null==x||null==(e=x.username)?void 0:e.charAt(0))||"U"})})})]}):(0,n.jsxs)("nav",{className:"flex gap-2",children:[(0,n.jsx)(u.$,{asChild:!0,variant:"ghost",children:(0,n.jsx)(i(),{href:"/",children:"Login"})}),(0,n.jsx)(u.$,{asChild:!0,children:(0,n.jsx)(i(),{href:"/register",children:"Sign Up"})})]})})]})}):(0,n.jsx)("header",{className:"py-4 px-6 bg-background border-b shadow-sm sticky top-0 z-10",children:(0,n.jsxs)("div",{className:"container mx-auto flex justify-between items-center",children:[(0,n.jsx)("div",{className:"h-6 w-24 bg-muted rounded animate-pulse"}),(0,n.jsxs)("div",{className:"flex items-center gap-4",children:[(0,n.jsx)("div",{className:"h-6 w-6 bg-muted rounded-full animate-pulse"}),(0,n.jsx)("div",{className:"h-8 w-8 bg-muted rounded-full animate-pulse"})]})]})})}},4697:(e,t,r)=>{r.d(t,{F:()=>o});var n=r(2115),a=r(9829),s=r(4269);let i="http://localhost:5000/api".replace("/api","")||"http://localhost:5000";function o(){let e=(0,n.useRef)(null),[t,r]=(0,n.useState)(!1),o=(0,n.useRef)(0),c=(0,n.useRef)(!1);return(0,n.useEffect)(()=>{let t=null,n=()=>{if(c.current||!(0,s.wR)())return;let l=localStorage.getItem("authToken");l&&(c.current=!0,e.current&&e.current.disconnect(),(t=(0,a.io)(i,{auth:{token:"Bearer ".concat(l)},reconnection:!0,reconnectionAttempts:5,reconnectionDelay:1e3,reconnectionDelayMax:5e3,transports:["websocket","polling"],timeout:1e4})).on("connect",()=>{r(!0),c.current=!1,o.current=0}),t.on("disconnect",e=>{r(!1),c.current=!1,"io client disconnect"!==e&&o.current<5&&(o.current++,setTimeout(n,1e3*o.current))}),t.on("connect_error",e=>{r(!1),c.current=!1}),e.current=t)};return n(),()=>{c.current=!1,e.current&&(e.current.connected&&e.current.close(),e.current=null),r(!1)}},[]),{socket:e.current,connected:t}}},7868:(e,t,r)=>{r.d(t,{Tr:()=>i,bA:()=>o,he:()=>c});var n=r(2466),a=r(8260),s=r(5894);async function i(){try{if(!localStorage.getItem("authToken"))return[];return((await n.A.get("/notifications/unread")).data.notifications||[]).map(e=>{var t;let r={id:e.id,type:{ANSWER_CREATED:"answer",QUESTION_CREATED:"comment",MENTION:"mention",REPUTATION:"reputation",SUMMARY:"summary",FOLLOWER:"follower"}[e.type]||"comment",title:e.message||"Notification",description:(t=e.context)?"object"==typeof t?t.tags&&Array.isArray(t.tags)?"Tags: ".concat(t.tags.join(", ")):t.questionId?"Question ID: ".concat(t.questionId):t.authorId?"Author ID: ".concat(t.authorId):JSON.stringify(t,null,2):"string"==typeof t?t:String(t):"",time:(0,a.m)(new Date(e.created_at),{addSuffix:!0}),read:!1,entityId:e.entity_id,entityType:{ANSWER_CREATED:"answer",QUESTION_CREATED:"question",MENTION:"question",REPUTATION:"user",SUMMARY:"question",FOLLOWER:"user"}[e.type]||"question"};return{...r,link:function(e){if(!e.entityId)return"/dashboard";switch(e.entityType){case"question":case"answer":return"/questions/".concat(e.entityId);case"user":return"/profile";default:return"/dashboard"}}(r)}})}catch(t){var e;return console.error("Error fetching notifications:",t),(null==(e=t.response)?void 0:e.status)===401?(0,s.toast)({title:"Session Expired",description:"Please log in again to continue.",variant:"destructive"}):(0,s.toast)({title:"Error",description:"Failed to fetch notifications. Please try again later.",variant:"destructive"}),[]}}async function o(e){try{if(!localStorage.getItem("authToken"))return!1;return await n.A.post("/notifications/".concat(e,"/read")),!0}catch(e){return console.error("Error marking notification as read:",e),!1}}async function c(){try{if(!localStorage.getItem("authToken"))return 0;return(await n.A.post("/notifications/read-all")).data.count||0}catch(e){return console.error("Error marking all notifications as read:",e),0}}}}]);